name: Mint RubyGems Token
on:
  workflow_call:
    outputs:
      rubygems_token:
        description: Minted RubyGems API token via OIDC
        value: ${{ jobs.mint.outputs.rubygems_token }}
jobs:
  mint:
    name: Mint RubyGems token
    runs-on: ubuntu-latest
    permissions:
      id-token: write
    steps:
      - name: Configure RubyGems Credentials
        id: configure
        uses: rubygems/configure-rubygems-credentials@main
        with:
          trusted-publisher: true
      - name: Export token for Speakeasy
        id: output-token
        run: |
          RUBYGEMS_OIDC="$RUBYGEMS_API_KEY"
          if [ -z "$RUBYGEMS_OIDC" ]; then
            echo "var is empty"
          fi
          echo "rubygems_oidc=$RUBYGEMS_OIDC" >> "$GITHUB_OUTPUT"
    outputs:
      rubygems_oidc: ${{ steps.output-token.outputs.rubygems_oidc }}
